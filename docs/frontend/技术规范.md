# 前端技术规范

> 本文档面向 AI 代码助手和开发者，定义前端开发的技术标准和约束。

## 1. 技术栈

| 类别 | 技术 | 版本 | 说明 |
|------|------|------|------|
| 框架 | Vue | 3.4+ | Composition API + `<script setup>` |
| 语言 | TypeScript | 5.0+ | 严格类型检查 |
| 构建 | Vite | 5.0+ | 开发服务器 + 打包 |
| UI 组件 | shadcn-vue / reka-ui | - | 基于 Radix 的无样式组件 |
| 样式 | TailwindCSS | 3.0+ | 原子化 CSS |
| 状态管理 | Pinia | 2.1+ | Vue 官方状态管理 |
| 路由 | Vue Router | 4.2+ | SPA 路由 |
| HTTP | Axios | 1.6+ | API 请求封装 |
| 图标 | Lucide Vue Next | 0.303+ | 图标库 |
| 日期 | dayjs | 1.11+ | 日期格式化 |
| 通知 | vue-sonner | 2.0+ | Toast 通知 |

## 2. 项目结构

```
frontend/
├── src/
│   ├── api/                  # API 请求层
│   │   ├── auth.ts          # 认证相关
│   │   ├── account.ts       # 账号管理
│   │   ├── cron.ts          # 定时任务
│   │   └── system.ts        # 系统配置
│   ├── assets/               # 静态资源
│   │   └── main.css         # 全局样式 + CSS 变量
│   ├── components/           # 组件
│   │   ├── ui/              # shadcn-vue 基础组件
│   │   │   ├── button/
│   │   │   ├── card/
│   │   │   ├── dialog/
│   │   │   ├── dropdown-menu/
│   │   │   ├── input/
│   │   │   └── ...
│   │   └── common/          # 业务通用组件
│   │       └── ModeToggle.vue
│   ├── layouts/              # 布局组件
│   │   └── AdminLayout.vue  # 后台管理布局
│   ├── lib/                  # 工具库
│   │   └── utils.ts         # cn() 等工具函数
│   ├── pages/                # 页面组件
│   │   ├── login/
│   │   │   └── index.vue
│   │   ├── dashboard/
│   │   │   └── index.vue
│   │   ├── account/
│   │   │   └── index.vue
│   │   └── system/
│   │       ├── cron.vue
│   │       ├── push.vue
│   │       └── config.vue
│   ├── router/               # 路由配置
│   │   └── index.ts
│   ├── stores/               # Pinia 状态
│   │   └── auth.ts          # 认证状态
│   ├── utils/                # 工具函数
│   │   ├── request.ts       # Axios 封装
│   │   └── time.ts          # 时间格式化
│   ├── App.vue              # 根组件
│   └── main.ts              # 入口文件
├── public/                   # 公共静态资源
├── index.html               # HTML 模板
├── package.json
├── tailwind.config.js       # Tailwind 配置
├── tsconfig.json            # TypeScript 配置
└── vite.config.ts           # Vite 配置
```

## 3. 编码规范

### 3.1 组件编写

```vue
<script setup lang="ts">
// 1. 导入顺序：Vue → 外部库 → 内部模块 → 类型
import { ref, computed, onMounted } from 'vue'
import { useRoute } from 'vue-router'
import { toast } from 'vue-sonner'
import { Button } from '@/components/ui/button'
import { getAccounts, type Account } from '@/api/account'

// 2. Props 定义（使用 defineProps + TypeScript）
const props = defineProps<{
  title: string
  disabled?: boolean
}>()

// 3. Emits 定义
const emit = defineEmits<{
  submit: [data: FormData]
  cancel: []
}>()

// 4. 响应式状态
const loading = ref(false)
const accounts = ref<Account[]>([])

// 5. 计算属性
const isEmpty = computed(() => accounts.value.length === 0)

// 6. 方法
async function loadData() {
  loading.value = true
  try {
    accounts.value = await getAccounts()
  } finally {
    loading.value = false
  }
}

// 7. 生命周期
onMounted(loadData)
</script>

<template>
  <!-- 模板内容 -->
</template>
```

### 3.2 类型安全

```typescript
// ❌ 禁止使用 any
const data: any = {}

// ✅ 定义明确类型
interface Account {
  id: number
  username: string
  status: number
  last_checkin: string | null
}

// ✅ API 返回类型断言
const accounts = await getAccounts() as Account[]

// ✅ 泛型 ref
const accounts = ref<Account[]>([])
```

### 3.3 命名约定

```typescript
// 文件名：kebab-case
user-profile.vue
use-auth.ts

// 组件名：PascalCase
ModeToggle.vue
UserProfile.vue

// 变量/函数：camelCase
const userName = ref('')
function handleSubmit() {}

// 常量：UPPER_SNAKE_CASE
const API_BASE_URL = '/api'

// 类型/接口：PascalCase
interface UserInfo {}
type ButtonVariant = 'default' | 'outline'
```

### 3.4 样式规范

使用 TailwindCSS 原子类，禁止内联 style：

```vue
<!-- ❌ 禁止 -->
<div style="margin-top: 16px; color: red;">

<!-- ✅ 推荐 -->
<div class="mt-4 text-destructive">

<!-- 条件类名使用 cn() -->
<div :class="cn('rounded-md', isActive && 'bg-primary')">

<!-- 响应式设计 -->
<div class="flex flex-col md:flex-row gap-4">
```

## 4. API 层规范

### 4.1 请求封装

```typescript
// src/utils/request.ts
import axios from 'axios'
import { useAuthStore } from '@/stores/auth'

const request = axios.create({
  baseURL: '/api',
  timeout: 30000,
})

// 请求拦截器：添加 Token
request.interceptors.request.use((config) => {
  const auth = useAuthStore()
  if (auth.token) {
    config.headers.Authorization = `Bearer ${auth.token}`
  }
  return config
})

// 响应拦截器：统一处理
request.interceptors.response.use(
  (response) => {
    const { code, message, data } = response.data
    if (code === 0) return data
    return Promise.reject(new Error(message))
  },
  (error) => {
    if (error.response?.status === 401) {
      // 未授权跳转登录
      useAuthStore().logout()
      router.push('/login')
    }
    return Promise.reject(error)
  }
)
```

### 4.2 API 函数定义

```typescript
// src/api/account.ts
import request from '@/utils/request'

export interface Account {
  id: number
  username: string
  status: number
}

export function getAccounts(): Promise<Account[]> {
  return request.get('/accounts')
}

export function createAccount(data: { session: string }) {
  return request.post('/accounts', data)
}

export function deleteAccount(id: number) {
  return request.delete(`/accounts/${id}`)
}
```

## 5. 状态管理

### 5.1 Pinia Store 定义

```typescript
// src/stores/auth.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'

export const useAuthStore = defineStore('auth', () => {
  // 状态
  const token = ref(localStorage.getItem('token') || '')
  const username = ref('')

  // Getters
  const isLoggedIn = computed(() => !!token.value)

  // Actions
  function setToken(newToken: string) {
    token.value = newToken
    localStorage.setItem('token', newToken)
  }

  function logout() {
    token.value = ''
    username.value = ''
    localStorage.removeItem('token')
  }

  return { token, username, isLoggedIn, setToken, logout }
})
```

## 6. 路由规范

```typescript
// src/router/index.ts
import { createRouter, createWebHistory } from 'vue-router'
import { useAuthStore } from '@/stores/auth'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/login',
      component: () => import('@/pages/login/index.vue'),
    },
    {
      path: '/',
      component: () => import('@/layouts/AdminLayout.vue'),
      meta: { requiresAuth: true },  // 需要认证
      children: [
        { path: '', redirect: '/dashboard' },
        { path: 'dashboard', component: () => import('@/pages/dashboard/index.vue') },
        // ...
      ],
    },
  ],
})

// 路由守卫
router.beforeEach((to, _from, next) => {
  const auth = useAuthStore()
  if (to.meta.requiresAuth && !auth.isLoggedIn) {
    next('/login')
  } else {
    next()
  }
})
```

## 7. UI 组件使用

### 7.1 shadcn-vue 组件导入

```typescript
// 从 @/components/ui 导入
import { Button } from '@/components/ui/button'
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card'
import { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
```

### 7.2 图标使用

```typescript
// 从 lucide-vue-next 导入
import { Plus, Trash2, Settings, LogOut } from 'lucide-vue-next'

// 在模板中使用
<Plus class="w-4 h-4" />
```

### 7.3 Toast 通知

```typescript
import { toast } from 'vue-sonner'

// 成功
toast.success('操作成功')

// 错误
toast.error('操作失败: ' + error.message)

// 加载
toast.loading('处理中...')
```

## 8. 主题系统

### 8.1 CSS 变量

```css
/* src/assets/main.css */
:root {
  --background: 0 0% 100%;
  --foreground: 240 10% 3.9%;
  --card: 0 0% 100%;
  --primary: 240 5.9% 10%;
  --muted: 240 4.8% 95.9%;
  --destructive: 0 84.2% 60.2%;
  /* ... */
}

.dark {
  --background: 240 6% 6%;
  --foreground: 0 0% 98%;
  --card: 240 5% 14%;
  /* ... */
}
```

### 8.2 主题切换

```typescript
// 使用 @vueuse/core
import { useColorMode } from '@vueuse/core'

const mode = useColorMode()
mode.value = 'dark'  // 'light' | 'dark' | 'auto'
```

## 9. 开发命令

```bash
# 安装依赖
npm install

# 开发服务器
npm run dev

# 类型检查
npm run type-check

# 代码检查
npm run lint

# 生产构建
npm run build
```

## 10. 禁止事项

1. **禁止**使用 `any` 类型
2. **禁止**使用 Options API（必须使用 Composition API）
3. **禁止**直接操作 DOM（使用 ref 绑定）
4. **禁止**在模板中使用复杂表达式（提取为 computed）
5. **禁止**使用内联 style 样式
6. **禁止**硬编码 API 地址
7. **禁止**在组件中直接调用 axios（使用封装的 request）
8. **禁止**忽略 TypeScript 错误 `// @ts-ignore`
9. **禁止**使用 `var` 声明变量
10. **禁止**组件文件超过 300 行（应拆分）
